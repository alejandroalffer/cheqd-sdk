<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="2424" height="3151" contentScriptType="application/ecmascript" contentStyleType="text/css" style="width:2424px;height:3151px" preserveAspectRatio="none" version="1.1" viewBox="0 0 2424 3151" zoomAndPan="magnify"><defs><filter id="fnf0og5" width="300%" height="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4" dy="4" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text x="1132" y="23.132" fill="#000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="158">DID Exchange Protocol</text><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="895" x2="895" y1="68.197" y2="3113.789"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1091.5" x2="1091.5" y1="68.197" y2="3113.789"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1277.5" x2="1277.5" y1="68.197" y2="3113.789"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1464" x2="1464" y1="68.197" y2="3113.789"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1713.5" x2="1713.5" y1="68.197" y2="3113.789"/><line style="stroke:#a80036;stroke-width:1;stroke-dasharray:5,5" x1="1936" x2="1936" y1="68.197" y2="3113.789"/><rect style="stroke:#a80036;stroke-width:1.5" width="44" height="30.099" x="871" y="33.099" fill="#FEFECE" filter="url(#fnf0og5)"/><text x="878" y="53.23" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30">Alice</text><rect style="stroke:#a80036;stroke-width:1.5" width="44" height="30.099" x="871" y="3112.789" fill="#FEFECE" filter="url(#fnf0og5)"/><text x="878" y="3132.921" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30">Alice</text><rect style="stroke:#a80036;stroke-width:1.5" width="95" height="30.099" x="1042.5" y="33.099" fill="#FEFECE" filter="url(#fnf0og5)"/><text x="1049.5" y="53.23" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81">Alice Agency</text><rect style="stroke:#a80036;stroke-width:1.5" width="95" height="30.099" x="1042.5" y="3112.789" fill="#FEFECE" filter="url(#fnf0og5)"/><text x="1049.5" y="3132.921" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81">Alice Agency</text><rect style="stroke:#a80036;stroke-width:1.5" width="85" height="30.099" x="1233.5" y="33.099" fill="#FEFECE" filter="url(#fnf0og5)"/><text x="1240.5" y="53.23" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71">Alice Agent</text><rect style="stroke:#a80036;stroke-width:1.5" width="85" height="30.099" x="1233.5" y="3112.789" fill="#FEFECE" filter="url(#fnf0og5)"/><text x="1240.5" y="3132.921" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71">Alice Agent</text><rect style="stroke:#a80036;stroke-width:1.5" width="142" height="30.099" x="1391" y="33.099" fill="#FEFECE" filter="url(#fnf0og5)"/><text x="1398" y="53.23" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128">Alice Pairwise Agent</text><rect style="stroke:#a80036;stroke-width:1.5" width="142" height="30.099" x="1391" y="3112.789" fill="#FEFECE" filter="url(#fnf0og5)"/><text x="1398" y="3132.921" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128">Alice Pairwise Agent</text><rect style="stroke:#a80036;stroke-width:1.5" width="39" height="30.099" x="1692.5" y="33.099" fill="#FEFECE" filter="url(#fnf0og5)"/><text x="1699.5" y="53.23" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="25">Bob</text><rect style="stroke:#a80036;stroke-width:1.5" width="39" height="30.099" x="1692.5" y="3112.789" fill="#FEFECE" filter="url(#fnf0og5)"/><text x="1699.5" y="3132.921" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="25">Bob</text><rect style="stroke:#a80036;stroke-width:1.5" width="80" height="30.099" x="1894" y="33.099" fill="#FEFECE" filter="url(#fnf0og5)"/><text x="1901" y="53.23" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66">Bob Agent</text><rect style="stroke:#a80036;stroke-width:1.5" width="80" height="30.099" x="1894" y="3112.789" fill="#FEFECE" filter="url(#fnf0og5)"/><text x="1901" y="3132.921" fill="#000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66">Bob Agent</text><rect style="stroke:#eee;stroke-width:1" width="2416" height="3" x="3" y="98.672" fill="#EEE" filter="url(#fnf0og5)"/><line style="stroke:#000;stroke-width:1" x1="3" x2="2419" y1="98.672" y2="98.672"/><line style="stroke:#000;stroke-width:1" x1="3" x2="2419" y1="101.672" y2="101.672"/><rect style="stroke:#000;stroke-width:2" width="98" height="22.949" x="1162" y="88.197" fill="#EEE" filter="url(#fnf0og5)"/><text x="1168" y="104.391" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80">Provisioning</text><polygon fill="#A80036" points="1080 291.633 1090 295.633 1080 299.633 1084 295.633" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="895" x2="1086" y1="295.633" y2="295.633"/><text x="902" y="291.827" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87">Provision Alice</text><polygon fill="#FBFB77" points="233 126.146 233 449.146 886 449.146 886 136.146 876 126.146 233 126.146" filter="url(#fnf0og5)" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="876" x2="876" y1="126.146" y2="136.146"/><line style="stroke:#a80036;stroke-width:1" x1="886" x2="876" y1="136.146" y2="136.146"/><text x="239" y="143.34" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76">Agency side:</text><text x="251" y="158.289" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242">We can keep the common workflow as is.</text><text x="251" y="173.237" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="395">We still can create Pairwise Agents on the initiation of connection or</text><text x="283" y="188.186" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303">accepting an invitation but use it as a mediator only.</text><text x="251" y="203.135" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304">In the current state Pairwise Agents are already able</text><text x="267" y="218.083" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166">- collect incoming messages</text><text x="267" y="233.032" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161">- return collected messages</text><text x="267" y="247.981" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219">- update status of received messages</text><text x="239" y="277.878" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="632">The key difference is that we will not use Agency anymore for sending messages to another connection side,</text><text x="267" y="292.827" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="329">so we don&apos;t need to keep other side keys on the Agency.</text><text x="239" y="307.776" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320">Vcx will do the message preparation and sending itself.</text><text x="239" y="337.673" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259">There is a problem with message forwarding:</text><text x="251" y="352.622" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="522">Now DIDs must be used as target (`to` filed) according to Cross-Domain Messaging HIPE.</text><text x="239" y="367.571" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="527">This problem is reflected in the issue: https://github.com/hyperledger/aries-rfcs/issues/255.</text><text x="239" y="382.519" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268">Lovesh&apos;s suggestion sounds acceptable to us.</text><text x="239" y="412.417" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="505">So, we need to change on Agency is making support of messages forwarding based on</text><text x="255" y="427.366" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247">Alice Verkey&apos;s (in addition to DID&apos;s based).</text><text x="239" y="442.315" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="589">It should be easy to distinguish because fully-qualified DID&apos;s must be used for a new protocol version.</text><polygon fill="#A80036" points="1266 475.069 1276 479.069 1266 483.069 1270 479.069" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1092" x2="1272" y1="479.069" y2="479.069"/><text x="1099" y="475.263" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87">Provision Alice</text><polygon fill="#A80036" points="1924 517.441 1934 521.441 1924 525.441 1928 521.441" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1714" x2="1930" y1="521.441" y2="521.441"/><polygon fill="#FBFB77" points="1941 493.018 1941 547.018 2405 547.018 2405 503.018 2395 493.018 1941 493.018" filter="url(#fnf0og5)" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="2395" x2="2395" y1="493.018" y2="503.018"/><line style="stroke:#a80036;stroke-width:1" x1="2405" x2="2395" y1="503.018" y2="503.018"/><text x="1947" y="510.212" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="443">In this diagram, we assume that Bob uses different Aries, compatible Agent.</text><text x="1947" y="525.161" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="338">He has published DIDDoc which is resolvable by Bob DID.</text><text x="1947" y="540.109" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371">Alice will send messages to Bob actor directly for simplification.</text><rect style="stroke:#eee;stroke-width:1" width="2416" height="3" x="3" y="577.339" fill="#EEE" filter="url(#fnf0og5)"/><line style="stroke:#000;stroke-width:1" x1="3" x2="2419" y1="577.339" y2="577.339"/><line style="stroke:#000;stroke-width:1" x1="3" x2="2419" y1="580.339" y2="580.339"/><rect style="stroke:#000;stroke-width:2" width="76" height="22.949" x="1173" y="566.864" fill="#EEE" filter="url(#fnf0og5)"/><text x="1179" y="583.058" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58">Invitation</text><polygon fill="#A80036" points="906 710.505 896 714.505 906 718.505 902 714.505" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="900" x2="1713" y1="714.505" y2="714.505"/><text x="912" y="710.699" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250">Share plain `invitation` message with Alice.</text><polygon fill="#FBFB77" points="1719 604.813 1719 808.813 2228 808.813 2228 614.813 2218 604.813 1719 604.813" filter="url(#fnf0og5)" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="2218" x2="2218" y1="604.813" y2="614.813"/><line style="stroke:#a80036;stroke-width:1" x1="2228" x2="2218" y1="614.813" y2="614.813"/><text x="1725" y="622.007" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">{</text><text x="1741" y="636.956" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="472">&quot;@type&quot;: &quot;did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/didexchange/1.0/invitation&quot;,</text><text x="1741" y="651.904" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195">&quot;@id&quot;: &quot;12345678900987654321&quot;,</text><text x="1741" y="666.853" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82">&quot;label&quot;: &quot;Bob&quot;,</text><text x="1741" y="681.802" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240">&quot;recipientKeys&quot;: [&quot;Bob Pairwise Verkey&quot;],</text><text x="1741" y="696.75" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297">&quot;serviceEndpoint&quot;: &quot;https://example.com/endpoint&quot;,</text><text x="1741" y="711.699" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211">&quot;routingKeys&quot;: [&quot;Bob Agent Verkey&quot;]</text><text x="1725" y="726.648" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">}</text><text x="1725" y="756.545" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="340">In the current state, we can support this Invite format only.</text><text x="1725" y="771.494" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="290">It contains all the information required for replying.</text><text x="1725" y="786.443" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="441">There is no formalized way to resolve DIDDoc using VCX for the public DID.</text><text x="1725" y="801.392" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286">We need to provide the separate PoA/HIPE for it.</text><rect style="stroke:#eee;stroke-width:1" width="2416" height="3" x="3" y="838.621" fill="#EEE" filter="url(#fnf0og5)"/><line style="stroke:#000;stroke-width:1" x1="3" x2="2419" y1="838.621" y2="838.621"/><line style="stroke:#000;stroke-width:1" x1="3" x2="2419" y1="841.621" y2="841.621"/><rect style="stroke:#000;stroke-width:2" width="143" height="22.949" x="1139.5" y="828.146" fill="#EEE" filter="url(#fnf0og5)"/><text x="1145.5" y="844.34" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125">Connection Request</text><line style="stroke:#a80036;stroke-width:1" x1="895" x2="937" y1="888.018" y2="888.018"/><line style="stroke:#a80036;stroke-width:1" x1="937" x2="937" y1="888.018" y2="901.018"/><line style="stroke:#a80036;stroke-width:1" x1="896" x2="937" y1="901.018" y2="901.018"/><polygon fill="#A80036" points="906 897.018 896 901.018 906 905.018 902 901.018" style="stroke:#a80036;stroke-width:1"/><polygon fill="#FBFB77" points="384 866.095 384 920.095 886 920.095 886 876.095 876 866.095 384 866.095" filter="url(#fnf0og5)" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="876" x2="876" y1="866.095" y2="876.095"/><line style="stroke:#a80036;stroke-width:1" x1="886" x2="876" y1="876.095" y2="876.095"/><text x="390" y="883.289" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="419">`vcx_connection_create_with_invite` -&gt; create `Connection` state object.</text><text x="390" y="898.238" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="406">`vcx_connection_connect` -&gt; create Alice Pairwise Agent on Agency,</text><text x="422" y="913.187" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="449">prepares `connection_request` message containing Alice DIDDoc and send it.</text><polygon fill="#A80036" points="1080 945.941 1090 949.941 1080 953.941 1084 949.941" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="895" x2="1086" y1="949.941" y2="949.941"/><text x="902" y="946.135" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162">Create Alice Pairwise Agent</text><polygon fill="#A80036" points="1266 974.89 1276 978.89 1266 982.89 1270 978.89" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1092" x2="1272" y1="978.89" y2="978.89"/><text x="1099" y="975.084" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162">Create Alice Pairwise Agent</text><polygon fill="#A80036" points="1452 1003.839 1462 1007.839 1452 1011.839 1456 1007.839" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1278" x2="1458" y1="1007.839" y2="1007.839"/><text x="1285" y="1004.033" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162">Create Alice Pairwise Agent</text><polygon fill="#A80036" points="906 1032.788 896 1036.788 906 1040.788 902 1036.788" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="900" x2="1463" y1="1036.788" y2="1036.788"/><text x="912" y="1032.981" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165">Alice Pairwise Agent Verkey</text><polygon fill="#A80036" points="1702 1365.711 1712 1369.711 1702 1373.711 1706 1369.711" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="895" x2="1708" y1="1369.711" y2="1369.711"/><text x="902" y="1365.905" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="424">send `encrypted_fwd_request` to `serviceEndpoint` taken from `invitation`</text><polygon fill="#FBFB77" points="8 1050.736 8 1672.736 886 1672.736 886 1060.736 876 1050.736 8 1050.736" filter="url(#fnf0og5)" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="876" x2="876" y1="1050.736" y2="1060.736"/><line style="stroke:#a80036;stroke-width:1" x1="886" x2="876" y1="1060.736" y2="1060.736"/><text x="14" y="1067.93" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="428">encrypted_fwd_request = &lt;pack(forward_message, &quot;Bob Agent Verkey&quot;)&gt;</text><text x="14" y="1097.828" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122">forward_message = {</text><text x="22" y="1112.776" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="432">&quot;@type&quot; : &quot;did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/forward&quot;,</text><text x="22" y="1127.725" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123">&quot;to&quot; : &quot;Bob Verkey&quot;,</text><text x="22" y="1142.674" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158">&quot;msg&quot; : encrypted_request</text><text x="14" y="1157.623" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">}</text><text x="14" y="1187.52" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="552">encrypted_request = &lt;pack(connection_request, Bob Pairwise Verkey, Alice Pairwise Verkey)&gt;</text><text x="14" y="1217.418" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133">connection_request = {</text><text x="22" y="1232.366" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146">&quot;@id&quot;: &quot;5678876542345&quot;,</text><text x="22" y="1247.315" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="463">&quot;@type&quot;: &quot;did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/didexchange/1.0/request&quot;,</text><text x="22" y="1262.264" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82">&quot;label&quot;: &quot;Bob&quot;,</text><text x="22" y="1277.212" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85">&quot;connection&quot;: {</text><text x="30" y="1292.161" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157">&quot;did&quot;: &quot;Alice Pairwise DID&quot;,</text><text x="46" y="1307.11" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67">&quot;did_doc&quot;: {</text><text x="38" y="1322.059" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212">&quot;@context&quot;: &quot;https://w3id.org/did/v1&quot;</text><text x="38" y="1337.007" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144">&quot;id&quot;: &quot;did:sov:1234abcd&quot;,</text><text x="38" y="1351.956" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79">&quot;publicKey&quot;: [</text><text x="46" y="1366.905" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="656">{&quot;id&quot;: &quot;Alice Pairwise Verkey&quot;, &quot;type&quot;: &quot;RsaVerificationKey2018&quot;, &quot;owner&quot;: &quot;did:sov:1234abcd&quot;,&quot;publicKeyPem&quot;: &quot;</text><text x="702" y="1366.905" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="line-through" textLength="4">-</text><text x="706" y="1366.905" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131">BEGIN PUBLIC X…&quot;},</text><text x="46" y="1381.853" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="651">{&quot;id&quot;: &quot;Alice Agency Verkey&quot;, &quot;type&quot;: &quot;RsaVerificationKey2018&quot;, &quot;owner&quot;: &quot;did:sov:1234abcd&quot;,&quot;publicKeyPem&quot;: &quot;</text><text x="697" y="1381.853" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="line-through" textLength="4">-</text><text x="701" y="1381.853" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129">BEGIN PUBLIC 9…&quot;},</text><text x="46" y="1396.802" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="694">{&quot;id&quot;: &quot;Alice Agent Pairwise Verkey&quot;, &quot;type&quot;: &quot;RsaVerificationKey2018&quot;, &quot;owner&quot;: &quot;did:sov:1234abcd&quot;,&quot;publicKeyPem&quot;: &quot;</text><text x="740" y="1396.802" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="line-through" textLength="4">-</text><text x="744" y="1396.802" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127">BEGIN PUBLIC A…&quot;}</text><text x="38" y="1411.751" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8">],</text><text x="38" y="1426.7" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103">&quot;authentication&quot;: [</text><text x="46" y="1441.648" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="459">{&quot;type&quot;: &quot;RsaSignatureAuthentication2018&quot;, &quot;publicKey&quot;: &quot;did:sov:1234abcd#4&quot;}</text><text x="38" y="1456.597" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8">],</text><text x="38" y="1471.546" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64">&quot;service&quot;: [</text><text x="46" y="1486.495" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">{</text><text x="54" y="1501.443" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348">&quot;id&quot;: &quot;did:example:123456789abcdefghi;did-communication&quot;,</text><text x="54" y="1516.392" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166">&quot;type&quot;: &quot;did-communication&quot;,</text><text x="54" y="1531.341" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72">&quot;priority&quot; : 0,</text><text x="54" y="1546.29" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258">&quot;recipientKeys&quot; : [ &quot;Alice Pairwise Verkey&quot; ],</text><text x="54" y="1561.238" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="426">&quot;routingKeys&quot; : [ &quot;Alice Agency Verkey&quot;, &quot;Alice Pairwise Agent Verkey&quot; ],</text><text x="54" y="1576.187" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297">&quot;serviceEndpoint&quot; : &quot;https://example.com/endpoint&quot;</text><text x="46" y="1591.136" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">}</text><text x="38" y="1606.084" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">]</text><text x="30" y="1621.033" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">}</text><text x="22" y="1635.982" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">}</text><text x="14" y="1650.931" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">}</text><line style="stroke:#a80036;stroke-width:1" x1="1714" x2="1756" y1="1694.609" y2="1694.609"/><line style="stroke:#a80036;stroke-width:1" x1="1756" x2="1756" y1="1694.609" y2="1707.609"/><line style="stroke:#a80036;stroke-width:1" x1="1715" x2="1756" y1="1707.609" y2="1707.609"/><polygon fill="#A80036" points="1725 1703.609 1715 1707.609 1725 1711.609 1721 1707.609" style="stroke:#a80036;stroke-width:1"/><polygon fill="#FBFB77" points="1764 1687.634 1764 1711.634 2264 1711.634 2264 1697.634 2254 1687.634 1764 1687.634" filter="url(#fnf0og5)" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="2254" x2="2254" y1="1687.634" y2="1697.634"/><line style="stroke:#a80036;stroke-width:1" x1="2264" x2="2254" y1="1697.634" y2="1697.634"/><text x="1770" y="1704.828" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="479">Bob decrypts `connection_request` and generates `connection_response` for Alice.</text><rect style="stroke:#eee;stroke-width:1" width="2416" height="3" x="3" y="1742.057" fill="#EEE" filter="url(#fnf0og5)"/><line style="stroke:#000;stroke-width:1" x1="3" x2="2419" y1="1742.057" y2="1742.057"/><line style="stroke:#000;stroke-width:1" x1="3" x2="2419" y1="1745.057" y2="1745.057"/><rect style="stroke:#000;stroke-width:2" width="154" height="22.949" x="1134" y="1731.583" fill="#EEE" filter="url(#fnf0og5)"/><text x="1140" y="1747.777" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136">Connection Response</text><polygon fill="#A80036" points="1103 1830.378 1093 1834.378 1103 1838.378 1099 1834.378" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1097" x2="1713" y1="1834.378" y2="1834.378"/><text x="1109" y="1830.572" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="497">Send `encrypted_fwd_response` to `serviceEndpoint` taken from `connection_request`</text><polygon fill="#FBFB77" points="1719 1769.532 1719 1883.532 2184 1883.532 2184 1779.532 2174 1769.532 1719 1769.532" filter="url(#fnf0og5)" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="2174" x2="2174" y1="1769.532" y2="1779.532"/><line style="stroke:#a80036;stroke-width:1" x1="2184" x2="2174" y1="1779.532" y2="1779.532"/><text x="1725" y="1786.726" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="444">encrypted_fwd_response = &lt;pack(forward_message, Alice Agency Verkey)&gt;</text><text x="1725" y="1816.623" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122">forward_message = {</text><text x="1733" y="1831.572" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="428">&quot;@type&quot;: &quot;did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/forward&quot;,</text><text x="1733" y="1846.521" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220">&quot;to&quot; : &quot;Alice Pairwise Agent Verkey&quot;,</text><text x="1733" y="1861.469" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256">&quot;msg&quot; : encrypted_forward_inner_message</text><text x="1725" y="1876.418" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">}</text><polygon fill="#A80036" points="1452 1909.173 1462 1913.173 1452 1917.173 1456 1913.173" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1092" x2="1458" y1="1913.173" y2="1913.173"/><text x="1099" y="1909.367" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255">forward `encrypted_forward_inner_message`</text><line style="stroke:#a80036;stroke-width:1" x1="1464" x2="1506" y1="1978.942" y2="1978.942"/><line style="stroke:#a80036;stroke-width:1" x1="1506" x2="1506" y1="1978.942" y2="1991.942"/><line style="stroke:#a80036;stroke-width:1" x1="1465" x2="1506" y1="1991.942" y2="1991.942"/><polygon fill="#A80036" points="1475 1987.942 1465 1991.942 1475 1995.942 1471 1991.942" style="stroke:#a80036;stroke-width:1"/><polygon fill="#FBFB77" points="845 1927.122 845 2041.122 1455 2041.122 1455 1937.122 1445 1927.122 845 1927.122" filter="url(#fnf0og5)" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="1445" x2="1445" y1="1927.122" y2="1937.122"/><line style="stroke:#a80036;stroke-width:1" x1="1455" x2="1445" y1="1937.122" y2="1937.122"/><text x="851" y="1944.315" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="589">encrypted_forward_inner_message = &lt;pack(forward_inner_message, &quot;Alice Pairwise Agent Verkey&quot;)&gt;</text><text x="851" y="1974.213" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157">forward_inner_message = {</text><text x="859" y="1989.162" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="428">&quot;@type&quot;: &quot;did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/forward&quot;,</text><text x="859" y="2004.11" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182">&quot;to&quot; : &quot;Alice Pairwise Verkey&quot;,</text><text x="859" y="2019.059" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172">&quot;msg&quot; : encrypted_response</text><text x="851" y="2034.008" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">}</text><line style="stroke:#a80036;stroke-width:1" x1="1464" x2="1506" y1="2071.711" y2="2071.711"/><line style="stroke:#a80036;stroke-width:1" x1="1506" x2="1506" y1="2071.711" y2="2084.711"/><line style="stroke:#a80036;stroke-width:1" x1="1465" x2="1506" y1="2084.711" y2="2084.711"/><polygon fill="#A80036" points="1475 2080.711 1465 2084.711 1475 2088.711 1471 2084.711" style="stroke:#a80036;stroke-width:1"/><text x="1471" y="2066.956" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236">stores encrypted_response in the queue.</text><polygon fill="#A80036" points="1452 2108.711 1462 2112.711 1452 2116.711 1456 2112.711" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="895" x2="1458" y1="2112.711" y2="2112.711"/><text x="902" y="2108.905" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="390">`vcx_connection_update_state` all next steps are hidden in this call</text><polygon fill="#A80036" points="1452 2137.66 1462 2141.66 1452 2145.66 1456 2141.66" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="895" x2="1458" y1="2141.66" y2="2141.66"/><text x="902" y="2137.854" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217">get all messages {&apos;status&apos;: &apos;Received&apos;}</text><polygon fill="#A80036" points="906 2166.609 896 2170.609 906 2174.609 902 2170.609" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="900" x2="1463" y1="2170.609" y2="2170.609"/><text x="912" y="2166.803" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133">[ encrypted_response ]</text><line style="stroke:#a80036;stroke-width:1" x1="895" x2="937" y1="2438.186" y2="2438.186"/><line style="stroke:#a80036;stroke-width:1" x1="937" x2="937" y1="2438.186" y2="2451.186"/><line style="stroke:#a80036;stroke-width:1" x1="896" x2="937" y1="2451.186" y2="2451.186"/><polygon fill="#A80036" points="906 2447.186 896 2451.186 906 2455.186 902 2451.186" style="stroke:#a80036;stroke-width:1"/><text x="902" y="2433.431" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183">decrypt and process `response`</text><polygon fill="#FBFB77" points="48 2184.558 48 2687.558 886 2687.558 886 2194.558 876 2184.558 48 2184.558" filter="url(#fnf0og5)" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="876" x2="876" y1="2184.558" y2="2194.558"/><line style="stroke:#a80036;stroke-width:1" x1="886" x2="876" y1="2194.558" y2="2194.558"/><text x="54" y="2201.751" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="592">encrypted_response = &lt;pack(connection_response, &quot;Alice Pairwise Verkey&quot;, &quot;Bob Pairwise Verkey&quot;)&gt;</text><text x="54" y="2231.649" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143">connection_response = {</text><text x="62" y="2246.598" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="473">&quot;@type&quot;: &quot;did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/didexchange/1.0/response&quot;,</text><text x="62" y="2261.546" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195">&quot;@id&quot;: &quot;12345678900987654321&quot;,</text><text x="62" y="2276.495" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66">&quot;~thread&quot;: {</text><text x="70" y="2291.444" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="489">&quot;thid&quot;: &quot;&lt;The Thread ID is the Message ID (@id) of the first message in the thread&gt;&quot;</text><text x="62" y="2306.393" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8">},</text><text x="62" y="2321.341" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85">&quot;connection&quot;: {</text><text x="70" y="2336.29" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151">&quot;did&quot;: &quot;Bob Pairwise DID&quot;,</text><text x="86" y="2351.239" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67">&quot;did_doc&quot;: {</text><text x="78" y="2366.188" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212">&quot;@context&quot;: &quot;https://w3id.org/did/v1&quot;</text><text x="78" y="2381.136" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144">&quot;id&quot;: &quot;did:sov:1234abcd&quot;,</text><text x="78" y="2396.085" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79">&quot;publicKey&quot;: [</text><text x="86" y="2411.034" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="650">{&quot;id&quot;: &quot;Bob Pairwise Verkey&quot;, &quot;type&quot;: &quot;RsaVerificationKey2018&quot;, &quot;owner&quot;: &quot;did:sov:1234abcd&quot;,&quot;publicKeyPem&quot;: &quot;</text><text x="736" y="2411.034" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="line-through" textLength="4">-</text><text x="740" y="2411.034" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131">BEGIN PUBLIC X…&quot;},</text><text x="86" y="2425.982" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="635">{&quot;id&quot;: &quot;Bob Agent Verkey&quot;, &quot;type&quot;: &quot;RsaVerificationKey2018&quot;, &quot;owner&quot;: &quot;did:sov:1234abcd&quot;,&quot;publicKeyPem&quot;: &quot;</text><text x="721" y="2425.982" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="line-through" textLength="4">-</text><text x="725" y="2425.982" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127">BEGIN PUBLIC A…&quot;}</text><text x="78" y="2440.931" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8">],</text><text x="78" y="2455.88" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103">&quot;authentication&quot;: [</text><text x="86" y="2470.829" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="459">{&quot;type&quot;: &quot;RsaSignatureAuthentication2018&quot;, &quot;publicKey&quot;: &quot;did:sov:1234abcd#4&quot;}</text><text x="78" y="2485.777" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8">],</text><text x="78" y="2500.726" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64">&quot;service&quot;: [</text><text x="86" y="2515.675" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">{</text><text x="94" y="2530.624" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348">&quot;id&quot;: &quot;did:example:123456789abcdefghi;did-communication&quot;,</text><text x="94" y="2545.572" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166">&quot;type&quot;: &quot;did-communication&quot;,</text><text x="94" y="2560.521" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72">&quot;priority&quot; : 0,</text><text x="94" y="2575.47" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252">&quot;recipientKeys&quot; : [ &quot;Bob Pairwise Verkey&quot; ],</text><text x="94" y="2590.419" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227">&quot;routingKeys&quot; : [ &quot;Bob Agent Verkey&quot; ],</text><text x="94" y="2605.367" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="425">&quot;serviceEndpoint&quot; : &quot;did:example:xd45fr567794lrzti67;did-communication&quot;</text><text x="86" y="2620.316" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">}</text><text x="78" y="2635.265" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">]</text><text x="70" y="2650.213" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">}</text><text x="62" y="2665.162" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">}</text><text x="54" y="2680.111" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">}</text><polygon fill="#A80036" points="1452 2712.866 1462 2716.866 1452 2720.866 1456 2716.866" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="895" x2="1458" y1="2716.866" y2="2716.866"/><text x="902" y="2713.06" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143">update messages status</text><rect style="stroke:#eee;stroke-width:1" width="2416" height="3" x="3" y="2746.289" fill="#EEE" filter="url(#fnf0og5)"/><line style="stroke:#000;stroke-width:1" x1="3" x2="2419" y1="2746.289" y2="2746.289"/><line style="stroke:#000;stroke-width:1" x1="3" x2="2419" y1="2749.289" y2="2749.289"/><rect style="stroke:#000;stroke-width:2" width="41" height="22.949" x="1190.5" y="2735.814" fill="#EEE" filter="url(#fnf0og5)"/><text x="1196.5" y="2752.008" fill="#000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="23">Ack</text><polygon fill="#A80036" points="1702 2916.827 1712 2920.827 1702 2924.827 1706 2920.827" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="895" x2="1708" y1="2920.827" y2="2920.827"/><text x="902" y="2917.021" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181">`encrypted_fwd_ack` message.</text><polygon fill="#FBFB77" points="352 2773.763 352 3052.763 886 3052.763 886 2783.763 876 2773.763 352 2773.763" filter="url(#fnf0og5)" style="stroke:#a80036;stroke-width:1"/><line style="stroke:#a80036;stroke-width:1" x1="876" x2="876" y1="2773.763" y2="2783.763"/><line style="stroke:#a80036;stroke-width:1" x1="886" x2="876" y1="2783.763" y2="2783.763"/><text x="358" y="2790.957" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122">forward_message = {</text><text x="366" y="2805.906" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="432">&quot;@type&quot; : &quot;did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/forward&quot;,</text><text x="366" y="2820.854" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176">&quot;to&quot; : &quot;Bob Pairwise Verkey&quot;,</text><text x="366" y="2835.803" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136">&quot;msg&quot; : encrypted_ack</text><text x="358" y="2850.752" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">}</text><text x="358" y="2880.649" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="396">encrypted_fwd_ack = &lt;pack(forward_message, Bob Agent Verkey)&gt;</text><text x="358" y="2910.547" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41">ack = {</text><text x="374" y="2925.496" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="431">&quot;@type&quot;: &quot;did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/notification/1.0/ack&quot;,</text><text x="374" y="2940.444" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146">&quot;@id&quot;: &quot;5678876542345&quot;,</text><text x="374" y="2955.393" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87">&quot;status&quot;: &quot;OK&quot;,</text><text x="374" y="2970.342" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66">&quot;~thread&quot;: {</text><text x="382" y="2985.291" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="489">&quot;thid&quot;: &quot;&lt;The Thread ID is the Message ID (@id) of the first message in the thread&gt;&quot;</text><text x="374" y="3000.239" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8">},</text><text x="366" y="3015.188" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4">}</text><text x="358" y="3045.085" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="438">encrypted_ack = &lt;pack(ack, Bob Pairwise Verkey, Alice Pairwise Verkey)&gt;</text><line style="stroke:#a80036;stroke-width:1" x1="1714" x2="1756" y1="3082.789" y2="3082.789"/><line style="stroke:#a80036;stroke-width:1" x1="1756" x2="1756" y1="3082.789" y2="3095.789"/><line style="stroke:#a80036;stroke-width:1" x1="1715" x2="1756" y1="3095.789" y2="3095.789"/><polygon fill="#A80036" points="1725 3091.789 1715 3095.789 1725 3099.789 1721 3095.789" style="stroke:#a80036;stroke-width:1"/><text x="1721" y="3078.034" fill="#000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208">decrypt and process `ack` message</text></g></svg>